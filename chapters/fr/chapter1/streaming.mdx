# Streaming de donn√©es audio

L'un des plus grands d√©fis auxquels sont confront√©s les ensembles de donn√©es audio est leur taille. 
Une seule minute d'audio non compress√© de qualit√© CD (44,1 kHz, 16 bits) occupe un peu plus de 5 Mo de stockage. En r√®gle g√©n√©rale, un jeu de donn√©es audio contient des heures d'enregistrements.
Dans les sections pr√©c√©dentes, nous avons utilis√© un tr√®s petit sous-ensemble de jeux de donn√©es audio MINDS-14, mais les jeux de donn√©es audio typiques sont beaucoup plus volumineux.
Par exemple, la configuration `xs` (la plus petite) de [GigaSpeech de SpeechColab](https://huggingface.co/datasets/speechcolab/gigaspeech) ne contient que 10 heures de donn√©es d'entra√Ænement, mais prend plus de 13 Go d'espace de stockage pour le t√©l√©chargement et la pr√©paration. 
Alors, que se passe-t-il lorsque nous voulons nous entra√Æner sur un split plus grand ? 
La configuration `xl` compl√®te du m√™me jeu de donn√©es contient 10 000 heures de donn√©es d'entra√Ænement, n√©cessitant plus de 1 To d'espace de stockage. 
Pour la plupart d'entre nous, cela d√©passe largement les sp√©cifications d'un disque dur typique. Devons-nous d√©bourser et acheter du stockage suppl√©mentaire ? Ou existe-t-il un moyen de nous entra√Æner sur ces ensembles de donn√©es sans contraintes d'espace disque ?

 ü§ó *Datasets* vient √† la rescousse en proposant le mode [streaming](https://huggingface.co/docs/datasets/stream). 
 Le streaming nous permet de charger les donn√©es progressivement au fur et √† mesure que nous it√©rons sur le jeu de donn√©es. Plut√¥t que de t√©l√©charger l'ensemble du jeu de donn√©es en une seule fois, nous chargeons le jeu de donn√©es un exemple √† la fois.
 Nous it√©rons sur le jeu de donn√©es, chargeant et pr√©parant des exemples √† la vol√©e lorsqu'ils sont n√©cessaires. De cette fa√ßon, nous ne chargeons que les exemples que nous utilisons, et non ceux que nous ne sommes pas !
Une fois que nous avons termin√© avec un exemple d'exemple, nous continuons √† it√©rer sur le jeu de donn√©es et chargeons le suivant.
Le mode streaming pr√©sente trois avantages principaux par rapport au t√©l√©chargement simultan√© de l'ensemble du jeu de donn√©es :
* Espace disque : les exemples sont charg√©s en m√©moire un par un au fur et √† mesure que nous it√©rons sur l'ensemble de donn√©es. √âtant donn√© que les donn√©es ne sont pas t√©l√©charg√©es localement, il n'y a pas d'espace disque requis, vous pouvez donc utiliser des jeux de donn√©es de taille arbitraire.
* Temps de t√©l√©chargement et de traitement: les ensembles de donn√©es audio sont volumineux et n√©cessitent beaucoup de temps pour √™tre t√©l√©charg√©s et trait√©s. Avec le streaming, le chargement et le traitement se font √† la vol√©e, ce qui signifie que vous pouvez commencer √† utiliser le jeu de donn√©es d√®s que le premier exemple est pr√™t.
* Exp√©rimentation facile : vous pouvez exp√©rimenter sur une poign√©e d'exemples pour v√©rifier que votre script fonctionne sans avoir √† t√©l√©charger l'ensemble du jeu de donn√©es.

Il y a une mise en garde au mode streaming. Lors du t√©l√©chargement d'un jeu de donn√©es complet sans streaming, les donn√©es brutes et les donn√©es trait√©es sont enregistr√©es localement sur le disque. 
Si nous voulons r√©utiliser ce jeu de donn√©es, nous pouvons charger directement les donn√©es trait√©es √† partir du disque, en sautant les √©tapes de t√©l√©chargement et de traitement.  
Par cons√©quent, nous ne devons effectuer les op√©rations de t√©l√©chargement et de traitement qu'une seule fois, apr√®s quoi nous pouvons r√©utiliser les donn√©es pr√©par√©es.

Avec le mode streaming, les donn√©es ne sont pas t√©l√©charg√©es sur le disque. Ainsi, ni les donn√©es t√©l√©charg√©es ni les donn√©es pr√©trait√©es ne sont mises en cache.
Si nous voulons r√©utiliser le jeu de donn√©es, les √©tapes de streaming doivent √™tre r√©p√©t√©es, avec les fichiers audio charg√©s et trait√©s √† nouveau √† la vol√©e.
Pour cette raison, il est conseill√© de t√©l√©charger des jeux de donn√©es que vous √™tes susceptible d'utiliser plusieurs fois.

Comment activer le mode streaming ? Facile! Il suffit de d√©finir `streaming=True` lorsque vous chargez votre jeu de donn√©es. Le reste sera pris en charge pour vous :

```py
gigaspeech = load_dataset("speechcolab/gigaspeech", "xs", streaming=True)
```

Tout comme nous avons appliqu√© des √©tapes de pr√©traitement √† un sous-ensemble t√©l√©charg√© de MINDS-14, vous pouvez effectuer le m√™me pr√©traitement avec un jeu de donn√©es en streaming exactement de la m√™me mani√®re.
La seule diff√©rence est que vous ne pouvez plus acc√©der √† des √©chantillons individuels √† l'aide de l'indexation Python (c'est-√†-dire `gigaspeech["train"][sample_idx]`).
Au lieu de cela, vous devez it√©rer sur le jeu de donn√©es. Voici comment acc√©der √† un exemple lors de la diffusion en continu d'un jeu de donn√©es :

```py
next(iter(gigaspeech["train"]))
```
 
**Sortie :**

```out
{
    "segment_id": "YOU0000000315_S0000660",
    "speaker": "N/A",
    "text": "AS THEY'RE LEAVING <COMMA> CAN KASH PULL ZAHRA ASIDE REALLY QUICKLY <QUESTIONMARK>",
    "audio": {
        "path": "xs_chunks_0000/YOU0000000315_S0000660.wav",
        "array": array(
            [0.0005188, 0.00085449, 0.00012207, ..., 0.00125122, 0.00076294, 0.00036621]
        ),
        "sampling_rate": 16000,
    },
    "begin_time": 2941.89,
    "end_time": 2945.07,
    "audio_id": "YOU0000000315",
    "title": "Return to Vasselheim | Critical Role: VOX MACHINA | Episode 43",
    "url": "https://www.youtube.com/watch?v=zr2n1fLVasU",
    "source": 2,
    "category": 24,
    "original_full_path": "audio/youtube/P0004/YOU0000000315.opus",
}
```
Si vous souhaitez pr√©visualiser plusieurs exemples d'un grand jeu de donn√©es, utilisez `take()` pour obtenir les $n$ premiers √©l√©ments. Prenons les deux premiers exemples dans le jeu de donn√©es gigaspeech :

```py
gigaspeech_head = gigaspeech["train"].take(2)
list(gigaspeech_head)
```

**Sortie :**

```out
[
    {
        "segment_id": "YOU0000000315_S0000660",
        "speaker": "N/A",
        "text": "AS THEY'RE LEAVING <COMMA> CAN KASH PULL ZAHRA ASIDE REALLY QUICKLY <QUESTIONMARK>",
        "audio": {
            "path": "xs_chunks_0000/YOU0000000315_S0000660.wav",
            "array": array(
                [
                    0.0005188,
                    0.00085449,
                    0.00012207,
                    ...,
                    0.00125122,
                    0.00076294,
                    0.00036621,
                ]
            ),
            "sampling_rate": 16000,
        },
        "begin_time": 2941.89,
        "end_time": 2945.07,
        "audio_id": "YOU0000000315",
        "title": "Return to Vasselheim | Critical Role: VOX MACHINA | Episode 43",
        "url": "https://www.youtube.com/watch?v=zr2n1fLVasU",
        "source": 2,
        "category": 24,
        "original_full_path": "audio/youtube/P0004/YOU0000000315.opus",
    },
    {
        "segment_id": "AUD0000001043_S0000775",
        "speaker": "N/A",
        "text": "SIX TOMATOES <PERIOD>",
        "audio": {
            "path": "xs_chunks_0000/AUD0000001043_S0000775.wav",
            "array": array(
                [
                    1.43432617e-03,
                    1.37329102e-03,
                    1.31225586e-03,
                    ...,
                    -6.10351562e-05,
                    -1.22070312e-04,
                    -1.83105469e-04,
                ]
            ),
            "sampling_rate": 16000,
        },
        "begin_time": 3673.96,
        "end_time": 3675.26,
        "audio_id": "AUD0000001043",
        "title": "Asteroid of Fear",
        "url": "http//www.archive.org/download/asteroid_of_fear_1012_librivox/asteroid_of_fear_1012_librivox_64kb_mp3.zip",
        "source": 0,
        "category": 28,
        "original_full_path": "audio/audiobook/P0011/AUD0000001043.opus",
    },
]
```

Le mode streaming peut faire passer vos recherches au niveau sup√©rieur : non seulement les plus grands jeux de donn√©es vous sont accessibles mais vous pouvez facilement √©valuer les syst√®mes sur plusieurs jeux de donn√©es en une seule fois sans vous soucier de votre espace disque. 
Par rapport √† l'√©valuation sur un seul jeu de donn√©es, l'√©valuation multi-jeux de donn√©es donne une meilleure mesure des capacit√©s de g√©n√©ralisation d'un syst√®me de reconnaissance vocale (cf. *End-to-end Speech Benchmark* (ESB)).
